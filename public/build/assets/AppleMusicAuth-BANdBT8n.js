import{j as e}from"./ui-UjROl1yU.js";import{a as u,$ as f,m as j}from"./vendor--ALJc334.js";import{c as p,a as v,B as M}from"./button-Dq94DUpE.js";import{C as N,a as y,b,c as A,d as z}from"./card-1QrzIMt_.js";import{z as k}from"./app-D0w2CfcE.js";import"./charts-BlTULfni.js";const w=v("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function C({className:i,variant:o,...c}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:p(w({variant:o}),i),...c})}function I({className:i,...o}){return e.jsx("div",{"data-slot":"alert-description",className:p("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",i),...o})}function J({error:i}){const{theme:o}=k(),[c,n]=u.useState(!1),[l,r]=u.useState(i||null),m="eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiIsImtpZCI6IkM5R1A0QVlHNzIifQ.eyJpc3MiOiJDM0M5OTU4MlhaIiwiaWF0IjoxNzUxMDIxNDk5LCJleHAiOjE3NjY1NzM0OTl9.plU-0y4LbEJXdZgcdSIwjrQ359lXrwmyNDh7fFB92A2fEI2noQOkn4jdI3890V6418nkUtTnt2wtSfBUv5N9ng",x=()=>{if(typeof window.MusicKit<"u"){d();return}const t=document.createElement("script");t.src="https://js-cdn.music.apple.com/musickit/v3/musickit.js",t.onload=()=>d(),t.onerror=()=>{console.error("Failed to load MusicKit script"),r("Failed to load Apple Music. Please try again later."),n(!1)},document.head.appendChild(t)},d=async()=>{var t;try{console.log("Initializing MusicKit..."),await window.MusicKit.configure({developerToken:m,app:{name:"TrackCer",build:"1.0.0"},declarativeMarkup:!0}),console.log("MusicKit configured, requesting authorization...");const a=window.MusicKit.getInstance();a.addEventListener("authorizationStatusDidChange",s=>{console.log("Authorization status changed:",s.authorizationStatus)});try{const s=await a.authorize();s?(console.log("Authorization successful!"),g(s,a.storefrontId)):(r("Authorization was declined or failed."),n(!1))}catch(s){console.error("MusicKit authorization error:",s),s.name==="AUTHORIZATION_ERROR"||(t=s.message)!=null&&t.includes("mk-007")?r("Apple Music authorization failed. Please ensure you have an active Apple Music subscription."):r(`Failed to authorize with Apple Music: ${s.message||"Unknown error"}`),n(!1)}}catch(a){console.error("MusicKit initialization failed:",a),r(`Failed to connect to Apple Music: ${a.message||"Unknown error"}`),n(!1)}},g=(t,a)=>{j.post("/apple-music/connect",{music_user_token:t,storefront_id:a})},h=()=>{n(!0),r(null),x()};return e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Connect Apple Music"}),e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(N,{className:"border-border",children:[e.jsx(y,{className:"space-y-1 pb-6",children:e.jsx(b,{className:"text-2xl font-bold",children:"Connect Apple Music"})}),e.jsxs(A,{className:"text-center space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"One more step!"}),e.jsx("p",{className:"text-muted-foreground",children:"You've successfully signed in with your Apple ID."}),e.jsx("p",{className:"text-muted-foreground",children:"To access your music data, please connect your Apple Music account."})]}),l&&e.jsx(C,{variant:"destructive",children:e.jsx(I,{children:l})}),e.jsx(M,{onClick:h,disabled:c,size:"lg",className:"bg-[#FF5842] hover:bg-[#FF4732] dark:bg-[#4033FB] dark:hover:bg-[#3529E0] text-white",children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fab fa-apple mr-2"}),"Connect Apple Music"]})})]}),e.jsx(z,{className:"justify-center pt-6 pb-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect to unlock your personalized data"})})]})})})})]})}export{J as default};
