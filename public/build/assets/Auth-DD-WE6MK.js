import{j as e}from"./ui-UjROl1yU.js";import{q as h,a,m as f}from"./vendor--ALJc334.js";function b(){var d;const{props:c}=h(),[r,i]=a.useState(!1),[l,t]=a.useState(""),[m]=a.useState("eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiIsImtpZCI6IldIMzVNSlM3MjUifQ.eyJpc3MiOiJDM0M5OTU4MlhaIiwiaWF0IjoxNzQyNzM3OTQ2LCJleHAiOjE3NTgyODk5NDZ9.TOtbXRqIKqHxE9ChQZu3Mdj76ZpHahTyWfjPqUnhJfeifuMjmzxPBJtA9cYY8fKrSglXHOXmvCuI5-OpCL9koA");a.useEffect(()=>{if(!window.MusicKit){const s=document.createElement("script");s.src="https://js-cdn.music.apple.com/musickit/v3/musickit.js",s.onload=()=>console.log("MusicKit loaded"),s.onerror=()=>t("Failed to load Apple Music. Please try again later."),document.head.appendChild(s)}},[]);const p=async()=>{i(!0),t("");try{if(!window.MusicKit)throw new Error("MusicKit not loaded.");await window.MusicKit.configure({developerToken:m,app:{name:"Trackcer",build:"1.0.0"}});const s=window.MusicKit.getInstance();s.addEventListener("authorizationStatusDidChange",o=>{console.log("Authorization status changed:",o.authorizationStatus)});const u=await s.authorize();if(u){const o=s.storefrontId;f.post(route("apple-music.connect"),{music_user_token:u,storefront_id:o},{onError:n=>{t((n==null?void 0:n.message)||"Authorization failed."),i(!1)}})}else throw new Error("Authorization was declined or failed.")}catch(s){console.error("MusicKit error:",s),t(s.message.includes("mk-007")?"Apple Music authorization failed. Please ensure you have an active subscription.":s.message),i(!1)}};return e.jsx("div",{className:"container mx-auto max-w-xl mt-10",children:e.jsxs("div",{className:"shadow-sm rounded-lg border overflow-hidden",children:[e.jsx("div",{className:"bg-white border-b p-4",children:e.jsx("h2",{className:"text-xl font-bold mb-0",children:"Connect Apple Music"})}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h5",{className:"text-lg mb-3",children:"One more step!"}),e.jsx("p",{className:"mb-1",children:"You've successfully signed in with your Apple ID."}),e.jsx("p",{className:"mb-4",children:"To access your music data, please connect your Apple Music account."}),((d=c.flash)==null?void 0:d.error)&&e.jsx("div",{className:"alert alert-danger mb-3",children:c.flash.error}),l&&e.jsx("div",{className:"alert alert-danger mb-3",children:l}),e.jsx("button",{onClick:p,disabled:r,className:"btn btn-lg mt-4",style:{backgroundColor:"#f94c57",color:"#121212",borderColor:"#f94c57"},children:r?e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Connecting..."]}):e.jsxs("span",{children:[e.jsx("i",{className:"fab fa-apple mr-2"})," Connect Apple Music"]})})]}),e.jsx("div",{className:"bg-white border-t p-3 text-muted text-sm",children:"Connect to unlock your personalized data"})]})})}export{b as default};
